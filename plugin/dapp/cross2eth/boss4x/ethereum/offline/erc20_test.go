package offline

import (
	"math/big"
	"strings"
	"testing"

	"github.com/33cn/chain33/common/address"

	"github.com/ethereum/go-ethereum/accounts/abi"
	"github.com/ethereum/go-ethereum/common"
)

var bin = "0x60e06040527f6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c96080527f3211a674f8abb8634646a77134a2b58ec308057919e5ed68bbb65e7630d15dba60a0523480156200005957600080fd5b50604051620014a8380380620014a8833981810160405260a08110156200007f57600080fd5b8101908080516040519392919084640100000000821115620000a057600080fd5b908301906020820185811115620000b657600080fd5b8251640100000000811182820188101715620000d157600080fd5b82525081516020918201929091019080838360005b8381101562000100578181015183820152602001620000e6565b50505050905090810190601f1680156200012e5780820380516001836020036101000a031916815260200191505b50604052602001805160405193929190846401000000008211156200015257600080fd5b9083019060208201858111156200016857600080fd5b82516401000000008111828201881017156200018357600080fd5b82525081516020918201929091019080838360005b83811015620001b257818101518382015260200162000198565b50505050905090810190601f168015620001e05780820380516001836020036101000a031916815260200191505b5060409081526020828101519183015160609093015187519295509293506200020f9160049188019062000301565b5083516200022590600590602087019062000301565b5060038390556006805460ff191660ff929092169190911790556001600160a01b0316600090815260208181526040808320939093558451948101949094208251808401845260018152603160f81b9086015282517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f81870152808401919091527fc89efdaa54c0f20c7adf612882df0950f5a951637e0307cdcb4c672f298b8bc6606082015260808101919091523060a0808301919091528251808303909101815260c091820190925281519190930120909152506200039d565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200034457805160ff191683800117855562000374565b8280016001018555821562000374579182015b828111156200037457825182559160200191906001019062000357565b506200038292915062000386565b5090565b5b8082111562000382576000815560010162000387565b60805160a05160c0516110ca620003de60003980610688528061086e5280610b6b525080610a5c5280610afe52508061065b528061080152506110ca6000f3fe608060405234801561001057600080fd5b506004361061010b5760003560e01c806370a08231116100a2578063a457c2d711610071578063a457c2d714610398578063a9059cbb146103c4578063beacca13146103f0578063c9bf726b146103f8578063dd62ed3e146104c35761010b565b806370a08231146102775780637ecebe001461029d57806395d89b41146102c35780639fd5a6cf146102cb5761010b565b806330adf81f116100de57806330adf81f1461021d578063313ce567146102255780633644e51514610243578063395093511461024b5761010b565b806306fdde0314610110578063095ea7b31461018d57806318160ddd146101cd57806323b872dd146101e7575b600080fd5b6101186104f1565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561015257818101518382015260200161013a565b50505050905090810190601f16801561017f5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6101b9600480360360408110156101a357600080fd5b506001600160a01b038135169060200135610587565b604080519115158252519081900360200190f35b6101d56105a4565b60408051918252519081900360200190f35b6101b9600480360360608110156101fd57600080fd5b506001600160a01b038135811691602081013590911690604001356105aa565b6101d5610659565b61022d61067d565b6040805160ff9092168252519081900360200190f35b6101d5610686565b6101b96004803603604081101561026157600080fd5b506001600160a01b0381351690602001356106aa565b6101d56004803603602081101561028d57600080fd5b50356001600160a01b03166106f5565b6101d5600480360360208110156102b357600080fd5b50356001600160a01b0316610710565b610118610722565b610396600480360360a08110156102e157600080fd5b6001600160a01b03823581169260208101359091169160408201359160608101359181019060a08101608082013564010000000081111561032157600080fd5b82018360208201111561033357600080fd5b8035906020019184600183028401116401000000008311171561035557600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250929550610783945050505050565b005b6101b9600480360360408110156103ae57600080fd5b506001600160a01b0381351690602001356109ae565b6101b9600480360360408110156103da57600080fd5b506001600160a01b038135169060200135610a46565b6101d5610a5a565b6101b9600480360360a081101561040e57600080fd5b6001600160a01b03823581169260208101359091169160408201359160608101359181019060a08101608082013564010000000081111561044e57600080fd5b82018360208201111561046057600080fd5b8035906020019184600183028401116401000000008311171561048257600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250929550610a7e945050505050565b6101d5600480360360408110156104d957600080fd5b506001600160a01b0381358116916020013516610cb0565b60048054604080516020601f600260001961010060018816150201909516949094049384018190048102820181019092528281526060939092909183018282801561057d5780601f106105525761010080835404028352916020019161057d565b820191906000526020600020905b81548152906001019060200180831161056057829003601f168201915b5050505050905090565b600061059b610594610cdb565b8484610cdf565b50600192915050565b60035490565b60006105b7848484610dcb565b6001600160a01b0384166000908152600160205260408120816105d8610cdb565b6001600160a01b03166001600160a01b031681526020019081526020016000205490508281101561063a5760405162461bcd60e51b8152600401808060200182810382526028815260200180610fad6028913960400191505060405180910390fd5b61064e85610646610cdb565b858403610cdf565b506001949350505050565b7f000000000000000000000000000000000000000000000000000000000000000081565b60065460ff1690565b7f000000000000000000000000000000000000000000000000000000000000000081565b600061059b6106b7610cdb565b8484600160006106c5610cdb565b6001600160a01b03908116825260208083019390935260409182016000908120918b168152925290205401610cdf565b6001600160a01b031660009081526020819052604090205490565b60026020526000908152604090205481565b60058054604080516020601f600260001961010060018816150201909516949094049384018190048102820181019092528281526060939092909183018282801561057d5780601f106105525761010080835404028352916020019161057d565b428210156107d8576040805162461bcd60e51b815260206004820152601d60248201527f45524332305065726d69743a206578706972656420646561646c696e65000000604482015290519081900360640190fd5b6001600160a01b03808616600081815260026020908152604080832080546001810190915581517f0000000000000000000000000000000000000000000000000000000000000000818501528083019590955294891660608501526080840188905260a084019490945260c08084018790528451808503909101815260e08401855280519082012061190160f01b6101008501527f00000000000000000000000000000000000000000000000000000000000000006101028501526101228085018290528551808603909101815261014290940190945282519201919091209080806108c386610f21565b925092509250600060018583868660405160008152602001604052604051808581526020018460ff1681526020018381526020018281526020019450505050506020604051602081039080840390855afa158015610925573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b0381161580159061095b57508a6001600160a01b0316816001600160a01b0316145b6109965760405162461bcd60e51b815260040180806020018281038252602681526020018061101e6026913960400191505060405180910390fd5b6109a18b8b8b610cdf565b5050505050505050505050565b600080600160006109bd610cdb565b6001600160a01b0390811682526020808301939093526040918201600090812091881681529252902054905082811015610a285760405162461bcd60e51b81526004018080602001828103825260258152602001806110706025913960400191505060405180910390fd5b610a3c610a33610cdb565b85858403610cdf565b5060019392505050565b600061059b610a53610cdb565b8484610dcb565b7f000000000000000000000000000000000000000000000000000000000000000081565b600042831015610ad5576040805162461bcd60e51b815260206004820152601d60248201527f45524332305065726d69743a206578706972656420646561646c696e65000000604482015290519081900360640190fd5b6001600160a01b03808716600081815260026020908152604080832080546001810190915581517f00000000000000000000000000000000000000000000000000000000000000008185015280830195909552948a1660608501526080840189905260a084019490945260c08084018890528451808503909101815260e08401855280519082012061190160f01b6101008501527f0000000000000000000000000000000000000000000000000000000000000000610102850152610122808501829052855180860390910181526101429094019094528251920191909120908080610bc087610f21565b925092509250600060018583868660405160008152602001604052604051808581526020018460ff1681526020018381526020018281526020019450505050506020604051602081039080840390855afa158015610c22573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b03811615801590610c5857508b6001600160a01b0316816001600160a01b0316145b610c935760405162461bcd60e51b815260040180806020018281038252602c815260200180611044602c913960400191505060405180910390fd5b610c9e8c8c8c610dcb565b5060019b9a5050505050505050505050565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b3390565b6001600160a01b038316610d245760405162461bcd60e51b8152600401808060200182810382526024815260200180610ffa6024913960400191505060405180910390fd5b6001600160a01b038216610d695760405162461bcd60e51b8152600401808060200182810382526022815260200180610f656022913960400191505060405180910390fd5b6001600160a01b03808416600081815260016020908152604080832094871680845294825291829020859055815185815291517f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259281900390910190a3505050565b6001600160a01b038316610e105760405162461bcd60e51b8152600401808060200182810382526025815260200180610fd56025913960400191505060405180910390fd5b6001600160a01b038216610e555760405162461bcd60e51b8152600401808060200182810382526023815260200180610f426023913960400191505060405180910390fd5b610e60838383610f3c565b6001600160a01b03831660009081526020819052604090205481811015610eb85760405162461bcd60e51b8152600401808060200182810382526026815260200180610f876026913960400191505060405180910390fd5b6001600160a01b038085166000818152602081815260408083208787039055938716808352918490208054870190558351868152935191937fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef929081900390910190a350505050565b60208101516040820151606090920151909260009190911a90565b50505056fe45524332303a207472616e7366657220746f20746865207a65726f206164647265737345524332303a20617070726f766520746f20746865207a65726f206164647265737345524332303a207472616e7366657220616d6f756e7420657863656564732062616c616e636545524332303a207472616e7366657220616d6f756e74206578636565647320616c6c6f77616e636545524332303a207472616e736665722066726f6d20746865207a65726f206164647265737345524332303a20617070726f76652066726f6d20746865207a65726f206164647265737345524332305065726d69743a3a7065726d69743a20696e76616c6964207369676e617475726545524332305065726d69743a3a7472616e7366657246726f6d3a20696e76616c6964207369676e617475726545524332303a2064656372656173656420616c6c6f77616e63652062656c6f77207a65726fa264697066735822122077f29dee7cec0af39a4455d00188ef6f9554716fbb4a679f9aae561c890235d464736f6c63430007030033"
var abidata = "[{\"inputs\":[{\"internalType\":\"string\",\"name\":\"name_\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"symbol_\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"supply\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"uint8\",\"name\":\"decimals_\",\"type\":\"uint8\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"DOMAIN_SEPARATOR\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"PERMIT_TYPEHASH\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"TRANSFERFROM_TYPEHASH\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"account\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"subtractedValue\",\"type\":\"uint256\"}],\"name\":\"decreaseAllowance\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"addedValue\",\"type\":\"uint256\"}],\"name\":\"increaseAllowance\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"nonces\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"bytes\",\"name\":\"signature\",\"type\":\"bytes\"}],\"name\":\"permit\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"},{\"internalType\":\"bytes\",\"name\":\"signature\",\"type\":\"bytes\"}],\"name\":\"transferFromWithSignature\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]"

func Test_packData(t *testing.T) {

	parsed, err := abi.JSON(strings.NewReader(abidata))
	if err != nil {
		t.Log("abi.JSON(strings.NewReader(erc20.ERC20ABI)) error", err.Error())
		return

	}
	var owner = "0xd741c9f9e0A1F5bb1ed898115A683253F14c1F8b"
	var (
		symbol   = "EDX"
		unit     = big.NewInt(1e8)
		bnAmount = unit.Mul(unit, big.NewInt(100000))
	)
	bin := common.FromHex(bin)
	Erc20OwnerAddr := common.HexToAddress(owner)
	packdata, err := parsed.Pack("", symbol, symbol, bnAmount, Erc20OwnerAddr, uint8(8))
	if err != nil {
		t.Log("Pack error", err.Error())
		return
	}

	var allPack []byte
	allPack = append(bin, packdata...)
	t.Log("packdata:", common.Bytes2Hex(allPack))
	t.Log("addr:", address.ExecAddress("coins"))

}
